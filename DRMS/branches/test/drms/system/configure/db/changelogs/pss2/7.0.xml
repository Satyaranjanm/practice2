<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd
    http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">

    <!-- NOTE !!!! -->
    <!-- If this file is moved, the attribute 'logicalFilePath' *MUST* be 
        added to the databaseChangeLog tag with a value equal to the previous relative 
        path of this file from drms/system/configure. For example, if this file was 
        in trunk/drms/system/configure/db/changelogs/pss2/changelogs.xml and was 
        moved to trunk/drms/system/configure/database/pss2/chnagelogs.xml, the attribute 
        logicalFilePath="db/changelogs/pss2/changelogs.xml" must be set or else the 
        changesets within this file will be re-applied to existing databases. This 
        could result in undesired behavior. See DRMS-5553 for more info. -->
    <!-- !!!! -->


    <!-- See http://liquibase.org/manual/home for documentation -->




    <changeSet id="1" author="Frank">
        <comment>
           DRMS-6242 Telemetry data number precision stored and displayed in graphic mouse-over is very long after the decimal point sometimes
        </comment>
        <sql>
			UPDATE dataset SET valuePrecision=3 WHERE name='Baseline' OR name ='Usage';
		</sql>
    </changeSet>

      <changeSet id="2" author="Ahmed">
            <preConditions onFail="MARK_RAN">
                <not>
                    <sqlCheck expectedResult="0">
                        select count(*) from
                        core_property;
                    </sqlCheck>
                </not>
                <sqlCheck expectedResult="0">
                    select count(*) from
                    core_property where propertyName='feature.international.format';
                </sqlCheck>
            </preConditions>
            <comment>
               DRMS-5117 International date format
            </comment>
            <sql>insert into core_property(uuid, version, propertyName,
                stringValue, booleanValue, doubleValue, textValue, type,
                creator, modifier, creationTime, modifiedTime) values
                (REPLACE(uuid(), '-', ''), 0, 'feature.international.format',
                null, false, null, null, 'Boolean', 'script', null, now(),
                null);
            </sql>
    </changeSet>
	
	<changeSet id="3" author="Frank">
        <comment>
           DRMS-6244 Usage labels are different when comparing the Telemetry tab and the Customer Reports
        </comment>
        <sql>
			UPDATE dataset SET description='Projected Nomal Usage' WHERE name='Baseline';
		</sql>
    </changeSet>
	
	<changeSet id="4" author="Frank">
        <comment>
           DRMS-6337 Usage: Missing data makes for strange baseline.
        </comment>
        <sql>
			insert into core_property(uuid, version, propertyName,
            stringValue, booleanValue, doubleValue, textValue, type,
            creator, modifier, creationTime, modifiedTime) values
            (REPLACE(uuid(), '-', ''), 0, 'interpolate.shiftsize',
            null, null, 60, null, 'Number', 'script', null, now(),
            null),
			(REPLACE(uuid(), '-', ''), 0, 'interpolate.windowsize',
            null, null, 600, null, 'Number', 'script', null, now(),
            null),
			(REPLACE(uuid(), '-', ''), 0, 'interpolate.runinterval',
            null, null, 60, null, 'Number', 'script', null, now(),
            null);
		</sql>
    </changeSet>

	<changeSet id="5" author="Linda">
        <comment>
           DRMS-6056 Create a view of who has opted out of an event for the operator on the event Detail
        </comment>
        <addColumn tableName="event_participant">
            <column name="eventOptOut" type="int(11)" defaultValueNumeric="0">
                <constraints nullable="true" />
            </column>
        </addColumn>
        <addColumn tableName="event_participant">
            <column name="optOutTime" type="DATETIME">
                <constraints nullable="true" />
            </column>
        </addColumn>
	</changeSet>
	
	<changeSet id="6" author="Frank">
        <comment>
           DRMS-6262 Telemetry - Gaps in actual usage data is not a different color
        </comment>
        <addColumn tableName="dataset">
            <column name="missingDataType" type="int(11)" defaultValueNumeric="0">
                <constraints nullable="true" />
            </column>
        </addColumn>       
	</changeSet>
    
    <changeSet id="7" author="Ahmed">
        <comment>
           DRMS-6404 Change telemtry graph label from "Projcted Normal Usage" to "Baseline"
        </comment>
        <sql>
			UPDATE dataset SET description='Baseline' WHERE name='Baseline';
		</sql>
    </changeSet>
        <changeSet id="8" author="Ahmed">
        <comment>
           DRMS-6422 Change telemtry graph label event end
        </comment>
        <sql>
			UPDATE dataset SET description='Event End' WHERE name='EventEndIndicator';
		</sql>
    </changeSet>

      <changeSet id="9" author="Ahmed">
        <comment>
           DRMS-6422 Change telemtry graph label to event start
        </comment>
        <sql>
			UPDATE dataset SET description='Event Start' WHERE name='EventStartIndicator';
		</sql>
    </changeSet>

</databaseChangeLog>