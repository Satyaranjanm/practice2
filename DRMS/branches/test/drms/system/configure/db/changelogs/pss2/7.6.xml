<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd
    http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">

    <!-- NOTE !!!! -->
    <!-- If this file is moved, the attribute 'logicalFilePath' *MUST* be 
        added to the databaseChangeLog tag with a value equal to the previous relative 
        path of this file from drms/system/configure. For example, if this file was 
        in trunk/drms/system/configure/db/changelogs/pss2/changelogs.xml and was 
        moved to trunk/drms/system/configure/database/pss2/chnagelogs.xml, the attribute 
        logicalFilePath="db/changelogs/pss2/changelogs.xml" must be set or else the 
        changesets within this file will be re-applied to existing databases. This 
        could result in undesired behavior. See DRMS-5553 for more info. -->
    <!-- !!!! -->
    <!-- See http://liquibase.org/manual/home for documentation -->	
	
	<changeSet id="1" author="Liu">
        <comment>
           DRMS-7425 Be able to view tomorrow's telemetry page.
        </comment>
		<sql>
		        insert into core_property(uuid, version, propertyName,
                stringValue, booleanValue, doubleValue, textValue, type,
                creator, modifier, creationTime, modifiedTime) values
                (REPLACE(uuid(), '-', ''), 0, 'feature.telemetry.tomorrowEnable',
                null, false, null, null, 'Boolean', 'script', null, now(),
                null);
		</sql>
    </changeSet>

	<changeSet id="2" author="Linda">
        <comment>
            DRMS-7092: set feature.demandLimiting and enableInterruptiblePrograms to false as default
        </comment>
		<update tableName="core_property">
			<column name="booleanValue" valueBoolean="false"/>
			<where>propertyName='feature.demandLimiting'</where>
		</update>
		<update tableName="core_property">
			<column name="booleanValue" valueBoolean="false"/>
			<where>propertyName='enableInterruptiblePrograms'</where>
		</update>
    </changeSet>

	<changeSet id="3" author="Linda">
        <comment>
            DRMS-7501: Add core property copyright to save the information: © 2007-2012 Akuacom All Rights Reserved.
        </comment>
		<insert tableName="core_property">
            <column name="uuid" valueNumeric="REPLACE(uuid(), '-', '') " />
            <column name="version" valueNumeric="0" />
            <column name="propertyName" value="copyright" />
            <column name="stringValue" value="© 2007-2012 &lt;a href=&quot;http://www.akuacom.com&quot;\&gt;Akuacom&lt;/a&gt; All Rights Reserved." />
            <column name="type" value="String" />
            <column name="creator" value="script" />
            <column name="creationTime" valueNumeric="now() " />
		</insert>
    </changeSet>
	<changeSet id="4" author="Linda">
        <comment>
            DRMS-7286: Add core property logo and logo.link.
        </comment>
		<insert tableName="core_property">
            <column name="uuid" valueNumeric="REPLACE(uuid(), '-', '') " />
            <column name="version" valueNumeric="0" />
            <column name="propertyName" value="logo" />
            <column name="stringValue" value="default.png" />
            <column name="type" value="String" />
            <column name="creator" value="script" />
            <column name="creationTime" valueNumeric="now() " />
		</insert>
    </changeSet>

	<changeSet id="5" author="Linda">
        <comment>
            DRMS-7535: change logoUrls url
        </comment>
		<update tableName="core_property">
			<column name="stringValue" value="images/logo/pierlogo.gif,images/logo/lbl_logo.gif,images/logo/drrclogo.gif"/>
			<where>propertyName='logoUrls'</where>
		</update>
    </changeSet>
    
    <changeSet id="6" author="Frank">
        <comment>
           DRMS-7066:need to be able to disable weather display in dashboard
        </comment>
		<sql>
		        insert into core_property(uuid, version, propertyName,
                stringValue, booleanValue, doubleValue, textValue, type,
                creator, modifier, creationTime, modifiedTime) values
                (REPLACE(uuid(), '-', ''), 0, 'simple.dashboard.enableWeather',
                null, true, null, null, 'Boolean', 'script', null, now(),
                null);
		</sql>
    </changeSet>
	<changeSet id="7" author="Liu">
        <comment>
           DRMS-6955 set a default value to customer info upload
        </comment>
		<sql>
		        insert into core_property(uuid, version, propertyName,
                stringValue, booleanValue, doubleValue, textValue, type,
                creator, modifier, creationTime, modifiedTime) values
                (REPLACE(uuid(), '-', ''), 0, 'feature.customerInfo.upload.enable',
                null, false, null, null, 'Boolean', 'script', null, now(),
                null);
		</sql>
    </changeSet>
	
	<changeSet id="8" author="Daoping">
        <comment>
           DRMS-7347 index for performance 
        </comment>
		<sql>
		      ALTER TABLE participant_manualsignal ADD INDEX manualsgl_participant (participant_uuid);
		</sql>
    </changeSet>
	
	<changeSet id="9" author="Daoping">
        <comment>
           DRMS-7347 index for performance 
        </comment>
		<sql>
		     ALTER TABLE client_status ADD UNIQUE UQX_ClientStatus(client_uuid, startTime,status);
		</sql>
    </changeSet>
	
		<changeSet id="10" author="Daoping">
        <comment>
           DRMS-7347 index for performance 
        </comment>
		<sql>
		     ALTER TABLE participant_contact ADD CONSTRAINT FK_participant_contact FOREIGN KEY (participant_uuid) REFERENCES participant (uuid);
			 ALTER TABLE program ADD UNIQUE UQX_NAME (name);
			 ALTER TABLE client_status ADD INDEX idx_clientsts_clientId(client_uuid);
		</sql>
    </changeSet>

		<changeSet id="11" author="Dichen">
        <comment>
           DRMS-7347 index for performance, ref. id. 28
        </comment>
		<sql>
			 ALTER TABLE history_event_participant_signal ADD INDEX idx_history_event_participant_signal_eventName(eventName);
			 ALTER TABLE history_event_participant_signal ADD INDEX idx_history_event_participant_signal_participantName(participantName);
		</sql>
    </changeSet>

  <changeSet id="12" author="Dichen">
    <comment>
      DRMS-7347 index for performance, ref. id. 35
    </comment>
    <sql>
      create index idx_he_evtend on history_event (endTime);
    </sql>
  </changeSet>

  <changeSet id="13" author="Dichen">
    <comment>
      DRMS-7347 index for performance, re. id. 40
    </comment>
    <sql>
      ALTER TABLE client_status ADD INDEX idx_clientsts_startTime(startTime);
      ALTER TABLE client_status ADD INDEX idx_clientsts_endTime(endTime);
    </sql>
  </changeSet>
</databaseChangeLog>