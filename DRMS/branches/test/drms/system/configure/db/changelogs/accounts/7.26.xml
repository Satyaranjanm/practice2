<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd
    http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">

    <!-- NOTE !!!! -->
    <!-- If this file is moved, the attribute 'logicalFilePath' *MUST* be 
        added to the databaseChangeLog tag with a value equal to the previous relative 
        path of this file from drms/system/configure. For example, if this file was 
        in trunk/drms/system/configure/db/changelogs/pss2/changelogs.xml and was 
        moved to trunk/drms/system/configure/database/pss2/chnagelogs.xml, the attribute 
        logicalFilePath="db/changelogs/pss2/changelogs.xml" must be set or else the 
        changesets within this file will be re-applied to existing databases. This 
        could result in undesired behavior. See DRMS-5553 for more info. -->
    <!-- !!!! -->

    <!-- See http://liquibase.org/manual/home for documentation -->
	<changeSet id="1" author="Navya">
        <comment>
				SGSFI-269 Correct spelling for role FacilityManager for DRAS7
		</comment>
        <sql>
			ALTER TABLE `accounts`.`userrole` DROP FOREIGN KEY `userrole_ibfk_2`, DROP FOREIGN KEY `userrole_ibfk_1`;
			
			UPDATE accounts.userrole SET rolename='FacilityManager' WHERE rolename='FaciliyManager';
			UPDATE accounts.roles SET rolename='FacilityManager' WHERE rolename='FaciliyManager';
			
			ALTER TABLE `accounts`.`userrole` 
				ADD CONSTRAINT `userrole_ibfk_1` 
				  FOREIGN KEY (`user_id`) 
				  REFERENCES `accounts`.`users` (`id`) 
				  ON DELETE RESTRICT 
				  ON UPDATE RESTRICT, 
				ADD CONSTRAINT `userrole_ibfk_2` 
				  FOREIGN KEY (`rolename`) 
				  REFERENCES `accounts`.`roles` (`rolename`) 
				  ON DELETE NO ACTION 
				  ON UPDATE NO ACTION;
		</sql>
    </changeSet>

</databaseChangeLog>